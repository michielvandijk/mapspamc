<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create synergy irrigated area map â€¢ mapspamc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Create synergy irrigated area map">
<meta property="og:description" content="mapspamc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapspamc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Background</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/crop_distribution_maps.html">Crop distribution maps</a>
        </li>
        <li>
          <a href="../articles/model_description.html">Model description</a>
        </li>
        <li>
          <a href="../articles/data.html">Input data</a>
        </li>
        <li>
          <a href="../articles/appendix.html">Appendix</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Preparation</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/input_data_collection.html">Input data collection</a>
        </li>
        <li>
          <a href="../articles/template.html">Country examples/templates</a>
        </li>
      </ul>
</li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Run SPAMc</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/model_setup.html">1. Model setup</a>
        </li>
        <li>
          <a href="../articles/process_subnational_statistics.html">2. Process subnational statistics</a>
        </li>
        <li>
          <a href="../articles/process_spatial_data.html">3. Process spatial data</a>
        </li>
        <li>
          <a href="../articles/create_synergy_cropland.html">4. Create synergy cropland map</a>
        </li>
        <li>
          <a href="../articles/create_synergy_irrigated_area.html">5. Create synergy irrigated area map</a>
        </li>
        <li>
          <a href="../articles/combine_input_data.html">6. Combine input data</a>
        </li>
        <li>
          <a href="../articles/run_model.html">7. Run model</a>
        </li>
        <li>
          <a href="../articles/post_process.html">8. Post-processing</a>
        </li>
        <li>
          <a href="../articles/replace_globiom_land_cover_land_use.html">9. Replace land cover and land use information in GLOBIOM</a>
        </li>
        <li>
          <a href="../articles/add_new_crop_to_globiom.html">10. Adding new crop to GLOBIOM</a>
        </li>
      </ul>
</li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iiasa/mapspamc">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="create_synergy_irrigated_area_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Create synergy irrigated area map</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/mapspamc/blob/master/vignettes/create_synergy_irrigated_area.Rmd"><code>vignettes/create_synergy_irrigated_area.Rmd</code></a></small>
      <div class="hidden name"><code>create_synergy_irrigated_area.Rmd</code></div>

    </div>

    
    
<p>The <code>01_create_synergy_irrigated_area_map.r</code> script in the <code>synergy_irrigated_area</code> folder describes the process to create the synergy irrigated area components that are needed by SPAMc. The procedure is slightly different than that used to create a the synergy cropland map because we only have two sources of information, which also have a different resolution. Most problematic is the GMIA, which has a relatively course resolution of 5 arcmin. This poses a problem when running the model at 30 arcsec as we do not know which of 100 30 arcsec grid cells in the 5 arcmin cells are irrigated. Another limitation is that even the GIA, the other global irrigated area product, which has a resolution of 30 arcsec only indicates the if there is irrigation in a grid cell. It does not present the actual area of irrigated cropland in a grid cell.</p>
<p>To address these issues, we use the following procedure to prepare the irrigated area cropland. First, process the GMIA and GIA so that they present the share of irrigated area within a grid cell, which can be compared at any spatial resolution. This has been done already at this stage if you ran the scripts to <a href="process_spatial_data.html">process the spatial data</a>. Next we stack the GMIA and GIA information and set very small shares (&lt;0.01) to zero. This small values are an anomaly as the are sometimes created when reprojecting the maps to a finer or coarser resolution and can safely be removed.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">ir_df</span> <span class="kw">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu">rasterToPoints</span>(<span class="fu"><a href="https://rdrr.io/r/utils/stack.html">stack</a></span>(<span class="no">grid</span>, <span class="no">grid_size</span>, <span class="no">gmia</span>, <span class="no">gia</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">gridID</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span>(-<span class="no">x</span>, -<span class="no">y</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">gia</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">gia</span> <span class="kw">&lt;</span> <span class="fl">0.01</span>, <span class="fl">0</span>, <span class="no">gia</span>),
         <span class="kw">gmia</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">gmia</span> <span class="kw">&lt;</span> <span class="fl">0.01</span>, <span class="fl">0</span>, <span class="no">gmia</span>))</pre></body></html></div>
<p>To rank the irrigated grid cells, we first take the maximum of the GMIA and GIA irrigated area share, use this to calculate the total grid level irrigated area and then rank the grid cells from 1 to 10 where 1 refers to preferred grid cells. This approach ensures that the grid cells with the largest irrigated area always receive a higher ranking, no matter the spatial resolution. This is important because when the resolution of the model is 5 arcmin, we prefer GMIA over GIA unless the latter presents a very large irrigated area share when aggregated to the 5 arcmin grid as well. Similarly, when the resolution is 30 arcsec, we prefer GIA over GMIA. At the same time, the ranking ensures that the potential irrigated area is expanded with the GMIA grid cells that have the highest irrigated area share.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ir_df</span> <span class="kw">&lt;-</span> <span class="no">ir_df</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">mutate</a></span>(<span class="kw">ir_max</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="no">gmia</span>, <span class="no">gia</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>),
                <span class="kw">ir_rank</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">ir_max</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">10</span>), <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span>),
                              <span class="kw">include.lowest</span> <span class="kw">=</span> <span class="no">T</span>),
                <span class="kw">ir_rank</span> <span class="kw">=</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(<span class="no">ir_rank</span>)),
                <span class="kw">ir_max</span> <span class="kw">=</span> <span class="no">ir_max</span> * <span class="no">grid_size</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">ir_rank</span>), <span class="no">ir_max</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span>(-<span class="no">gmia</span>, -<span class="no">gia</span>, -<span class="no">grid_size</span>)</pre></body></html></div>
<p>In a next step the maps for maximum irrigated area (see code example below) and the ranking are created.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ir_max_map</span> <span class="kw">&lt;-</span> <span class="no">ir_df</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">grid_df</span>,<span class="no">.</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/select.html">select</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="no">ir_max</span>)
<span class="no">ir_max_map</span> <span class="kw">&lt;-</span> <span class="fu">rasterFromXYZ</span>(<span class="no">ir_max_map</span>)
<span class="fu">crs</span>(<span class="no">ir_max_map</span>) <span class="kw">&lt;-</span> <span class="fu">crs</span>(<span class="no">param</span>$<span class="no">crs</span>)</pre></body></html></div>
<p>Finally the maps are saved for further processing. Please do not change the folder location or the names. This will result in errors as the files cannot be loaded by follow up scripts.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">temp_path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">param</span>$<span class="no">spam_path</span>, <span class="fu">glue</span>(<span class="st">"processed_data/maps/irrigated_area/{param$res}"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="no">temp_path</span>, <span class="kw">showWarnings</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu">writeRaster</span>(<span class="no">ir_max_map</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">temp_path</span>,
                                  <span class="kw pkg">glue</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"ia_max_{param$res}_{param$year}_{param$iso3c}.tif"</span>)),<span class="kw">overwrite</span> <span class="kw">=</span> <span class="no">T</span>)

<span class="fu">writeRaster</span>(<span class="no">ir_rank_map</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">temp_path</span>,
                                  <span class="kw pkg">glue</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"ia_rank_{param$res}_{param$year}_{param$iso3c}.tif"</span>)),<span class="kw">overwrite</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michiel Van Dijk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
